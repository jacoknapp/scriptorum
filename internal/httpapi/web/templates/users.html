{{ template "header" . }}
<div class="bg-night-800 rounded-xl2 shadow-card ring-1 ring-white/10 p-6">
	<div class="flex items-center justify-between mb-6">
		<h1 class="text-xl font-semibold">Users</h1>
	</div>

	<!-- Mobile list (small screens) -->
	<div class="md:hidden">
		<ul class="divide-y divide-white/5">
			{{ range .Users }}
			<li class="py-3">
				<div class="flex items-start justify-between gap-3">
					<div class="min-w-0">
						<div class="font-medium">{{ .Username }}</div>
						<div class="text-xs text-slate-400">ID {{ .ID }} • Admin: {{ if .IsAdmin }}yes{{ else }}no{{ end }}</div>
					</div>
					<div class="flex gap-3 shrink-0">
						<button
							data-id="{{ .ID }}"
							data-username="{{ .Username }}"
							data-isadmin="{{ .IsAdmin }}"
							onclick="openEditModal(parseInt(this.dataset.id), this.dataset.username, this.dataset.isadmin === 'true')"
							class="text-blue-400 hover:text-blue-300">Edit</button>
						<button
							data-id="{{ .ID }}"
							data-username="{{ .Username }}"
							onclick="openDeleteModal(parseInt(this.dataset.id), this.dataset.username)"
							class="text-red-400 hover:text-red-300">Delete</button>
					</div>
				</div>
			</li>
			{{ else }}
			<li class="p-4 text-slate-400">No users</li>
			{{ end }}
		</ul>
	</div>

	<!-- Desktop/tablet table (md and up) -->
	<div class="overflow-x-auto hidden md:block">
	<table class="w-full text-sm min-w-[540px]">
		<thead>
			<tr>
				<th class="text-left p-2">ID</th>
				<th class="text-left p-2">Username</th>
				<th class="text-left p-2">Admin</th>
				<th class="text-left p-2">Actions</th>
			</tr>
		</thead>
		<tbody>
			{{ range .Users }}
			<tr class="border-t border-white/5">
				<td class="p-2">{{ .ID }}</td>
				<td class="p-2">{{ .Username }}</td>
				<td class="p-2">{{ if .IsAdmin }}yes{{ else }}no{{ end }}</td>
				<td class="p-2">
					<button
						data-id="{{ .ID }}"
						data-username="{{ .Username }}"
						data-isadmin="{{ .IsAdmin }}"
						onclick="openEditModal(parseInt(this.dataset.id), this.dataset.username, this.dataset.isadmin === 'true')"
						class="text-blue-400 hover:text-blue-300 mr-2">Edit</button>
					<button
						data-id="{{ .ID }}"
						data-username="{{ .Username }}"
						onclick="openDeleteModal(parseInt(this.dataset.id), this.dataset.username)"
						class="text-red-400 hover:text-red-300">Delete</button>
				</td>
			</tr>
			{{ else }}
			<tr>
				<td colspan="4" class="p-4 text-slate-400">No users</td>
			</tr>
			{{ end }}
		</tbody>
	</table>
	</div>

	<!-- Create user button (bottom-right within card) -->
	<div class="flex justify-end mt-6">
		<button id="openCreateUser" aria-haspopup="dialog" class="px-4 py-2 bg-royal-600 text-white rounded-lg shadow-lg hover:bg-royal-500">Create User</button>
	</div>

	<!-- Modal: Create User -->
	<div id="createUserModal" class="hidden fixed inset-0 z-40 flex items-center justify-center" role="dialog" aria-modal="true" aria-labelledby="createUserTitle">
		<!-- overlay -->
		<div id="createUserOverlay" class="absolute inset-0 bg-black opacity-60"></div>

		<!-- dialog -->
		<div class="relative bg-night-800 rounded-xl2 shadow-card ring-1 ring-white/10 p-6 max-w-md w-full z-10">
			<div class="flex items-center justify-between mb-4">
				<h2 id="createUserTitle" class="text-lg font-semibold">Create User</h2>
				<button id="closeCreateUser" aria-label="Close" class="text-slate-400 hover:text-slate-200">✕</button>
			</div>

			<form method="post" action="/users" class="grid gap-3">
				<label class="grid gap-1">
					<span>Username</span>
					<input name="username" required class="border border-white/10 bg-night-900 text-slate-100 rounded px-3 py-2">
				</label>
				<label class="grid gap-1">
					<span>Password</span>
					<input type="password" name="password" required class="border border-white/10 bg-night-900 text-slate-100 rounded px-3 py-2">
				</label>
				<label class="inline-flex items-center gap-2">
					<input type="checkbox" name="is_admin">
					<span>Admin</span>
				</label>
				<div class="flex items-center justify-end gap-2 mt-2">
					<button type="button" id="cancelCreateUser" class="px-3 py-2 rounded border border-white/10 bg-night-900">Cancel</button>
					<button class="px-4 py-2 rounded bg-royal-600 hover:bg-royal-500 text-white">Add User</button>
				</div>
			</form>
		</div>
	</div>

	<!-- Modal: Edit User -->
	<div id="editUserModal" class="hidden fixed inset-0 z-40 flex items-center justify-center" role="dialog" aria-modal="true" aria-labelledby="editUserTitle">
		<!-- overlay -->
		<div id="editUserOverlay" class="absolute inset-0 bg-black opacity-60"></div>

		<!-- dialog -->
		<div class="relative bg-night-800 rounded-xl2 shadow-card ring-1 ring-white/10 p-6 max-w-md w-full z-10">
			<div class="flex items-center justify-between mb-4">
				<h2 id="editUserTitle" class="text-lg font-semibold">Edit User</h2>
				<button id="closeEditUser" aria-label="Close" class="text-slate-400 hover:text-slate-200">✕</button>
			</div>

			<form method="post" action="/users/edit" class="grid gap-3">
				<input type="hidden" name="user_id" id="editUserId">
				<div>
					<label class="block text-sm font-medium mb-1">Username</label>
					<div id="editUserName" class="px-3 py-2 bg-night-900 border border-white/10 rounded text-slate-300"></div>
				</div>
				<label class="grid gap-1">
					<span>New Password (leave blank to keep current)</span>
					<input type="password" name="password" id="editUserPassword" class="border border-white/10 bg-night-900 text-slate-100 rounded px-3 py-2">
				</label>
				<label class="grid gap-1">
					<span>Confirm New Password</span>
					<input type="password" name="confirm_password" id="editUserConfirmPassword" class="border border-white/10 bg-night-900 text-slate-100 rounded px-3 py-2">
				</label>
				<label class="inline-flex items-center gap-2">
					<input type="checkbox" name="is_admin" id="editUserAdmin">
					<span>Admin</span>
				</label>
				<div class="flex items-center justify-end gap-2 mt-2">
					<button type="button" id="cancelEditUser" class="px-3 py-2 rounded border border-white/10 bg-night-900">Cancel</button>
					<button class="px-4 py-2 rounded bg-blue-600 hover:bg-blue-500 text-white">Update User</button>
				</div>
			</form>
		</div>
	</div>

	<!-- Modal: Delete User Confirmation -->
	<div id="deleteUserModal" class="hidden fixed inset-0 z-40 flex items-center justify-center" role="dialog" aria-modal="true" aria-labelledby="deleteUserTitle">
		<!-- overlay -->
		<div id="deleteUserOverlay" class="absolute inset-0 bg-black opacity-60"></div>

		<!-- dialog -->
		<div class="relative bg-night-800 rounded-xl2 shadow-card ring-1 ring-white/10 p-6 max-w-md w-full z-10">
			<div class="flex items-center justify-between mb-4">
				<h2 id="deleteUserTitle" class="text-lg font-semibold">Delete User</h2>
				<button id="closeDeleteUser" aria-label="Close" class="text-slate-400 hover:text-slate-200">✕</button>
			</div>

			<div class="mb-4">
				<p>Are you sure you want to delete the user <strong id="deleteUserName"></strong>?</p>
				<p class="text-sm text-slate-400 mt-2">This action cannot be undone.</p>
			</div>

			<div class="flex items-center justify-end gap-2">
				<button type="button" id="cancelDeleteUser" class="px-3 py-2 rounded border border-white/10 bg-night-900">Cancel</button>
				<a id="confirmDeleteUser" href="#" class="px-4 py-2 rounded bg-red-600 hover:bg-red-500 text-white">Delete User</a>
			</div>
		</div>
	</div>

	<script>
	// Global modal functions
	function openEditModal(userId, username, isAdmin) {
		document.getElementById('editUserId').value = userId;
		document.getElementById('editUserName').textContent = username;
		document.getElementById('editUserAdmin').checked = isAdmin;
		document.getElementById('editUserPassword').value = '';
		document.getElementById('editUserConfirmPassword').value = '';
		document.getElementById('editUserModal').classList.remove('hidden');
	}

	function openDeleteModal(userId, username) {
		document.getElementById('deleteUserName').textContent = username;
		document.getElementById('confirmDeleteUser').href = '/users/delete?id=' + userId;
		document.getElementById('deleteUserModal').classList.remove('hidden');
	}

	// Create User Modal
	(function(){
		var openBtn = document.getElementById('openCreateUser');
		var modal = document.getElementById('createUserModal');
		var overlay = document.getElementById('createUserOverlay');
		var closeBtn = document.getElementById('closeCreateUser');
		var cancelBtn = document.getElementById('cancelCreateUser');

		function show() {
			modal.classList.remove('hidden');
		}
		function hide() {
			modal.classList.add('hidden');
		}

		if (openBtn) openBtn.addEventListener('click', show);
		if (closeBtn) closeBtn.addEventListener('click', hide);
		if (cancelBtn) cancelBtn.addEventListener('click', hide);
		if (overlay) overlay.addEventListener('click', hide);
	})();

	// Edit User Modal
	(function(){
		var modal = document.getElementById('editUserModal');
		var overlay = document.getElementById('editUserOverlay');
		var closeBtn = document.getElementById('closeEditUser');
		var cancelBtn = document.getElementById('cancelEditUser');

		function hide() {
			modal.classList.add('hidden');
		}

		if (closeBtn) closeBtn.addEventListener('click', hide);
		if (cancelBtn) cancelBtn.addEventListener('click', hide);
		if (overlay) overlay.addEventListener('click', hide);
	})();

	// Delete User Modal
	(function(){
		var modal = document.getElementById('deleteUserModal');
		var overlay = document.getElementById('deleteUserOverlay');
		var closeBtn = document.getElementById('closeDeleteUser');
		var cancelBtn = document.getElementById('cancelDeleteUser');

		function hide() {
			modal.classList.add('hidden');
		}

		if (closeBtn) closeBtn.addEventListener('click', hide);
		if (cancelBtn) cancelBtn.addEventListener('click', hide);
		if (overlay) overlay.addEventListener('click', hide);
	})();

	// Global ESC key handler for all modals
	document.addEventListener('keydown', function(e){
		if (e.key === 'Escape') {
			document.getElementById('createUserModal').classList.add('hidden');
			document.getElementById('editUserModal').classList.add('hidden');
			document.getElementById('deleteUserModal').classList.add('hidden');
		}
	});

	// Password confirmation validation
	document.addEventListener('DOMContentLoaded', function() {
		var form = document.querySelector('#editUserModal form');
		if (form) {
			form.addEventListener('submit', function(e) {
				var password = document.getElementById('editUserPassword').value;
				var confirmPassword = document.getElementById('editUserConfirmPassword').value;
				
				if (password && password !== confirmPassword) {
					e.preventDefault();
					alert('Passwords do not match!');
				}
			});
		}
	});
	</script>
</div>
{{ template "footer" . }}
