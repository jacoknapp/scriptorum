<div class="bg-white rounded-xl2 shadow-card ring-1 ring-slate-900/5">
	<div class="p-4 border-b">
		<h2 class="font-semibold">Results for “{{ .Query }}”</h2>
	</div>
	<ul class="divide-y">
		{{ range .Items }}
	<li class="p-4 grid gap-4 items-center grid-cols-[auto,1fr,24rem]">
			{{/* Use placeholder if no cover; fallback on error */}}
			<img src="{{ if .CoverMedium }}{{ .CoverMedium }}{{ else }}/static/placeholder-cover.svg{{ end }}"
					 class="w-16 h-24 object-cover rounded-lg border bg-slate-100"
					 onerror="this.onerror=null; this.src='/static/placeholder-cover.svg';">

			<div class="min-w-0">
				<div class="font-medium truncate">{{ .Title }}</div>
				<div class="text-sm text-slate-600 truncate">{{ if gt (len .Authors) 0 }}{{ index .Authors 0 }}{{ end }}</div>
				<div class="text-xs text-slate-500">
					{{ if .ISBN13 }}ISBN-13: {{ .ISBN13 }}{{ end }}
					{{ if and .ISBN13 .ISBN10 }}, {{ end }}
					{{ if .ISBN10 }}ISBN-10: {{ .ISBN10 }}{{ end }}
					{{ if .ASIN }}{{ if or .ISBN13 .ISBN10 }}, {{ end }}ASIN: {{ .ASIN }}{{ end }}
				</div>
				<!-- Source label removed: do not display which instance returned the result -->
				<div class="text-xs mt-2"
						 hx-get="/ui/presence?q={{ urlquery .Title }}{{ if gt (len .Authors) 0 }}%20{{ urlquery (index .Authors 0) }}{{ end }}"
						 hx-trigger="load"
						 hx-target="this">
					<span class="text-slate-400">Checking presence…</span>
				</div>
			</div>

			<form method="post" action="/api/v1/requests" class="flex gap-2 items-center justify-end"
					data-title="{{ .Title }}"
					data-isbn10="{{ .ISBN10 }}"
					data-isbn13="{{ .ISBN13 }}"
					data-asin="{{ .ASIN }}"
					data-author="{{ if gt (len .Authors) 0 }}{{ index .Authors 0 }}{{ end }}">
				<input type="hidden" name="title" value="{{ .Title }}">
				{{ range .Authors }}
				<input type="hidden" name="authors" value="{{ . }}">
				{{ end }}
				<input type="hidden" name="isbn10" value="{{ .ISBN10 }}">
				<input type="hidden" name="isbn13" value="{{ .ISBN13 }}">
				<input type="hidden" name="asin" value="{{ .ASIN }}">
				<!-- Always include provider payloads so server can attach Readarr payloads without exposing source -->
				<input type="hidden" name="provider_payload" value='{{ .ProviderPayload }}'>
				<input type="hidden" name="provider_payload_ebook" value='{{ .ProviderEbookPayload }}'>
				<input type="hidden" name="provider_payload_audiobook" value='{{ .ProviderAudiobookPayload }}'>

				<!-- Use the same purple and fixed width for both buttons so layout doesn't shift -->
				<button type="button" name="format" value="ebook"
						class="px-3 py-2 rounded-lg bg-royal-600 text-white hover:bg-royal-700 w-44"
						onclick="scriptorumRequestFallback(this,'ebook')">
						Request eBook
					</button>
				<button type="button" name="format" value="audiobook"
						class="px-3 py-2 rounded-lg bg-royal-600 text-white hover:bg-royal-700 w-44"
						onclick="scriptorumRequestFallback(this,'audiobook')">
						Request Audiobook
					</button>
			</form>
			<div class="req-ind htmx-indicator text-xs text-slate-500 hidden col-start-3">Submitting…</div>
		</li>
		{{ else }}
		<li class="p-6 text-slate-500">No results.</li>
		{{ end }}
	</ul>
</div>
