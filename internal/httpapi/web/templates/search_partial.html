<div class="bg-white rounded-xl2 shadow-card ring-1 ring-slate-900/5">
	<div class="p-4 border-b">
		<h2 class="font-semibold">Results for “{{ .Query }}”</h2>
	</div>
	<ul class="divide-y">
		{{ range .Items }}
		<li class="p-4 flex gap-4 items-center">
			<img src="{{ .CoverMedium }}"
					 class="w-16 h-24 object-cover rounded-lg border bg-slate-100"
					 onerror="this.style.display='none'">

			<div class="flex-1 min-w-0">
				<div class="font-medium truncate">{{ .Title }}</div>
				<div class="text-sm text-slate-600 truncate">{{ if gt (len .Authors) 0 }}{{ index .Authors 0 }}{{ end }}</div>
				<div class="text-xs text-slate-500">
					{{ if .ISBN13 }}ISBN-13: {{ .ISBN13 }}{{ end }}
					{{ if and .ISBN13 .ISBN10 }}, {{ end }}
					{{ if .ISBN10 }}ISBN-10: {{ .ISBN10 }}{{ end }}
					{{ if .ASIN }}{{ if or .ISBN13 .ISBN10 }}, {{ end }}ASIN: {{ .ASIN }}{{ end }}
				</div>
				{{ if .Provider }}
				<div class="text-[11px] text-slate-400 mt-1">Source: {{ .Provider }}</div>
				{{ end }}
				<div class="text-xs mt-2"
						 hx-get="/ui/presence?q={{ urlquery .Title }}{{ if gt (len .Authors) 0 }}%20{{ urlquery (index .Authors 0) }}{{ end }}"
						 hx-trigger="load"
						 hx-target="this">
					<span class="text-slate-400">Checking presence…</span>
				</div>
			</div>

			<form method="post" action="/api/v1/requests" class="flex gap-2 items-center"
					data-title="{{ .Title }}"
					data-isbn10="{{ .ISBN10 }}"
					data-isbn13="{{ .ISBN13 }}"
					data-asin="{{ .ASIN }}"
					data-author="{{ if gt (len .Authors) 0 }}{{ index .Authors 0 }}{{ end }}">
				<input type="hidden" name="title" value="{{ .Title }}">
				{{ range .Authors }}
				<input type="hidden" name="authors" value="{{ . }}">
				{{ end }}
				<input type="hidden" name="isbn10" value="{{ .ISBN10 }}">
				<input type="hidden" name="isbn13" value="{{ .ISBN13 }}">
				<input type="hidden" name="asin" value="{{ .ASIN }}">
				{{ if .Provider }}
				<input type="hidden" name="provider" value="{{ .Provider }}">
				<input type="hidden" name="provider_payload" value='{{ .ProviderPayload }}'>
				<input type="hidden" name="provider_payload_ebook" value='{{ .ProviderEbookPayload }}'>
				<input type="hidden" name="provider_payload_audiobook" value='{{ .ProviderAudiobookPayload }}'>
				{{ end }}

				<button type="button" name="format" value="ebook"
						class="px-3 py-2 rounded-lg bg-royal-600 text-white hover:bg-royal-700 w-36"
						onclick="scriptorumRequestFallback(this,'ebook')">
						Request eBook
					</button>
				<button type="button" name="format" value="audiobook"
						class="px-3 py-2 rounded-lg bg-royal-500 text-white hover:bg-royal-600 w-44"
						onclick="scriptorumRequestFallback(this,'audiobook')">
						Request Audiobook
					</button>
			</form>
			<div class="req-ind htmx-indicator text-xs text-slate-500">Submitting…</div>
		</li>
		{{ else }}
		<li class="p-6 text-slate-500">No results.</li>
		{{ end }}
	</ul>
</div>
