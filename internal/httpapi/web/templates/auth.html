{{ template "header" . }}
<div class="bg-night-800 rounded-xl2 shadow-card ring-1 ring-white/10 p-6">
  <h1 class="text-2xl font-semibold mb-6 text-white">Authentication Settings</h1>
  
  <form method="post" action="/settings/save" class="space-y-8">
    <input type="hidden" name="_csrf_token" value="{{.CSRFToken}}">
    <!-- OAuth Configuration Section -->
    <div class="bg-night-900 rounded-lg p-6 border border-white/10">
      <div class="mb-6">
        <h2 class="text-lg font-semibold text-white mb-2">OAuth Configuration</h2>
        <p class="text-sm text-slate-400">Configure OAuth/OIDC authentication for external identity providers like Authentik, Keycloak, Google, etc.</p>
      </div>

      <!-- Enable/Disable OAuth -->
      <div class="mb-8">
        <h3 class="text-sm font-semibold text-slate-200 mb-3 uppercase tracking-wide">Authentication Method</h3>
        <div class="flex items-center gap-6">
          <label class="inline-flex items-center gap-2 cursor-pointer">
            <input type="radio" name="oauth_enabled" value="true" class="text-royal-600 focus:ring-royal-500" {{if .Cfg.OAuth.Enabled}}checked{{end}}> 
            <span class="text-green-400 font-medium">Enable OAuth</span>
          </label>
          <label class="inline-flex items-center gap-2 cursor-pointer">
            <input type="radio" name="oauth_enabled" value="false" class="text-royal-600 focus:ring-royal-500" {{if not .Cfg.OAuth.Enabled}}checked{{end}}> 
            <span class="text-slate-400 font-medium">Disable OAuth</span>
          </label>
        </div>
        <p class="text-xs text-slate-500 mt-2">When enabled, users can authenticate using your OAuth provider in addition to local accounts</p>
      </div>

      <!-- Provider Settings -->
      <div class="mb-8">
        <h3 class="text-sm font-semibold text-slate-200 mb-4 uppercase tracking-wide">Provider Settings</h3>
        <div class="space-y-4">
          <div class="grid md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-slate-200 mb-2">Issuer URL</label>
              <input name="oauth_issuer" 
                     placeholder="Issuer" 
                     class="w-full px-4 py-3 bg-night-800 border border-white/20 text-slate-100 rounded-lg focus:ring-2 focus:ring-royal-500 focus:border-transparent" 
                     value="{{ .Cfg.OAuth.Issuer }}">
              <p class="text-xs text-slate-500 mt-1">Your OAuth provider's issuer/discovery URL</p>
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-200 mb-2">Client ID</label>
              <input name="oauth_client_id" 
                     placeholder="Client ID" 
                     class="w-full px-4 py-3 bg-night-800 border border-white/20 text-slate-100 rounded-lg focus:ring-2 focus:ring-royal-500 focus:border-transparent" 
                     value="{{ .Cfg.OAuth.ClientID }}">
              <p class="text-xs text-slate-500 mt-1">OAuth application client identifier</p>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-200 mb-2">Redirect URL</label>
            <input name="oauth_redirect" 
                   placeholder="Redirect URL" 
                   class="w-full px-4 py-3 bg-night-800 border border-white/20 text-slate-100 rounded-lg focus:ring-2 focus:ring-royal-500 focus:border-transparent" 
                   value="{{ .Cfg.OAuth.RedirectURL }}">
            <p class="text-xs text-slate-500 mt-1">Configure this URL in your OAuth provider's application settings</p>
          </div>
        </div>
      </div>

      <!-- Advanced OAuth Settings -->
      <div class="mb-8">
        <h3 class="text-sm font-semibold text-slate-200 mb-4 uppercase tracking-wide">Advanced Settings</h3>
        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-slate-200 mb-2">OAuth Scopes</label>
            <input name="oauth_scopes" 
                   placeholder="Scopes (comma-separated)" 
                   class="w-full px-4 py-3 bg-night-800 border border-white/20 text-slate-100 rounded-lg focus:ring-2 focus:ring-royal-500 focus:border-transparent" 
                   value="{{ range $i, $s := .Cfg.OAuth.Scopes }}{{ if $i }}, {{ end }}{{$s}}{{ end }}">
            <p class="text-xs text-slate-500 mt-1">Comma-separated list of OAuth scopes to request</p>
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-200 mb-2">Username Claim</label>
            <input name="oauth_username_claim" 
                   placeholder="Username claim" 
                   class="w-full px-4 py-3 bg-night-800 border border-white/20 text-slate-100 rounded-lg focus:ring-2 focus:ring-royal-500 focus:border-transparent" 
                   value="{{ .Cfg.OAuth.UsernameClaim }}">
            <p class="text-xs text-slate-500 mt-1">JWT claim field to extract username from</p>
          </div>
        </div>
      </div>

      <!-- User Management -->
      <div class="mb-6">
        <h3 class="text-sm font-semibold text-slate-200 mb-4 uppercase tracking-wide">User Management</h3>
        <div class="flex items-start gap-3">
          <input type="checkbox" 
                 name="oauth_autocreate" 
                 id="oauth_autocreate"
                 class="mt-1 text-royal-600 focus:ring-royal-500 rounded"
                 {{if .Cfg.OAuth.AutoCreateUsers}}checked{{end}}> 
          <div>
            <label for="oauth_autocreate" class="block text-sm font-medium text-slate-200 cursor-pointer">Auto-create users on first OAuth login</label>
            <p class="text-xs text-slate-500 mt-1">When enabled, new users will be automatically created when they first log in via OAuth</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Provider Examples -->
    <div class="bg-slate-900 rounded-lg p-6 border border-slate-700">
      <h3 class="text-sm font-semibold text-slate-200 mb-4 uppercase tracking-wide">Common Provider Examples</h3>
      <div class="grid md:grid-cols-2 gap-6">
        <div class="space-y-2">
          <h4 class="text-sm font-semibold text-slate-300">Authentik</h4>
          <div class="text-xs text-slate-400 space-y-1 font-mono">
            <div><span class="text-slate-300">Issuer:</span> https://auth.domain.com/application/o/app/</div>
            <div><span class="text-slate-300">Scopes:</span> openid, profile, email</div>
            <div><span class="text-slate-300">Username Claim:</span> preferred_username</div>
          </div>
        </div>
        <div class="space-y-2">
          <h4 class="text-sm font-semibold text-slate-300">Keycloak</h4>
          <div class="text-xs text-slate-400 space-y-1 font-mono">
            <div><span class="text-slate-300">Issuer:</span> https://keycloak.domain.com/realms/realm</div>
            <div><span class="text-slate-300">Scopes:</span> openid, profile, email</div>
            <div><span class="text-slate-300">Username Claim:</span> preferred_username</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex justify-end gap-3 pt-4 border-t border-white/10">
      <a class="px-4 py-2 text-royal-300 hover:text-royal-200 hover:underline transition-colors" href="/settings">
        Cancel
      </a>
      <button type="submit" class="px-6 py-2 bg-royal-600 text-white rounded-lg hover:bg-royal-500 focus:ring-2 focus:ring-royal-500 focus:ring-offset-2 focus:ring-offset-night-800 transition-colors font-medium">
        Save Settings
      </button>
    </div>
  </form>
</div>
{{ template "footer" . }}
