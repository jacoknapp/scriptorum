{{ template "header" . }}
<div class="bg-night-800 rounded-xl2 shadow-card ring-1 ring-white/10 p-6">
	<h1 class="text-xl font-semibold mb-3">Search books</h1>
	<form id="searchForm" class="flex flex-col sm:flex-row gap-2">
		<input name="q" class="flex-1 border border-white/10 bg-night-900 text-slate-100 placeholder-slate-400 rounded px-3 py-2 min-w-0"
			   placeholder="Title / Author / ISBN / ASIN / paste Amazon URL"
			   id="searchInput"
			   autocomplete="off">
		<input type="hidden" name="page" value="1">
		<input type="hidden" name="limit" value="20">
		<button class="px-4 py-2 rounded bg-royal-600 hover:bg-royal-500 text-white">Search</button>
	</form>
	<div id="searchIndicator" class="text-sm text-slate-400 mt-2" style="display: none;">Searchingâ€¦</div>
	</div>
<div id="results" class="mt-4">
	<!-- results will render here -->
</div>
<div id="more" class="md:block"
		 hx-get="/ui/search"
		 hx-trigger="revealed"
		 hx-target="#results"
		 hx-swap="beforeend"
		 hx-vals='js:(function(){
			 const f=document.getElementById("searchForm");
			 if(!f) return {};
			 const data=new FormData(f);
			 const page=parseInt(data.get("page")||"1");
			 data.set("page", String(page+1));
			 const obj=Object.fromEntries(data.entries());
			 // persist increment back to form for next page
			 f.querySelector("input[name=page]").value=String(page+1);
			 return obj;
		 })()'>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
	console.log('Search page: DOM loaded, initializing search...');
	
	var searchInput = document.getElementById('searchInput');
	var searchForm = document.getElementById('searchForm');
	
	if (!searchInput) {
		console.error('Search input not found!');
		return;
	}
	
	if (!searchForm) {
		console.error('Search form not found!');
		return;
	}
	
	// Wait for debouncedSearch to be available
	var initSearch = function() {
		if (typeof window.debouncedSearch !== 'function') {
			console.log('debouncedSearch not ready, waiting...');
			setTimeout(initSearch, 100);
			return;
		}
		
		console.log('Setting up search event listeners...');
		
		// Input event for typing
		searchInput.addEventListener('input', function(e) {
			console.log('Search input:', e.target.value);
			window.debouncedSearch(e.target.value);
		});
		
		// Form submit event
		searchForm.addEventListener('submit', function(e) {
			e.preventDefault();
			console.log('Search form submitted:', searchInput.value);
			window.debouncedSearch(searchInput.value, 0); // Immediate search
		});
		
		console.log('Search initialization complete!');
		
		// Focus on search input for better UX
		searchInput.focus();
	};
	
	initSearch();
});
</script>

{{ template "footer" . }}