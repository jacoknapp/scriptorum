{{ template "header" . }}
<div class="bg-night-800 rounded-xl2 shadow-card ring-1 ring-white/10 p-6">
	<h1 class="text-xl font-semibold mb-3">Search books</h1>
	<form id="searchForm" hx-get="/ui/search" hx-target="#results" hx-swap="innerHTML" class="flex flex-col sm:flex-row gap-2">
		<input name="q" class="flex-1 border border-white/10 bg-night-900 text-slate-100 placeholder-slate-400 rounded px-3 py-2 min-w-0"
			   placeholder="Title / Author / ISBN / ASIN / paste Amazon URL"
			   hx-trigger="keyup changed delay:400ms, search"
			   hx-include="#searchForm"
			   hx-get="/ui/search"
			   hx-target="#results"
			   hx-indicator="#searchIndicator"
			   hx-on="input: document.querySelector('#searchForm input[name=page]').value='1'"
			   hx-swap="innerHTML">
		<input type="hidden" name="page" value="1">
		<input type="hidden" name="limit" value="20">
		<button class="px-4 py-2 rounded bg-royal-600 hover:bg-royal-500 text-white">Search</button>
	</form>
	<div id="searchIndicator" class="text-sm text-slate-400 htmx-indicator mt-2">Searchingâ€¦</div>
	</div>
<div id="results" class="mt-4"
		 hx-get="/ui/search"
		 hx-trigger="revealed, intersect once from:top delay:100ms"
		 hx-vals='js:(function(){
			 const f=document.getElementById("searchForm");
			 if(!f) return {};
			 const data=new FormData(f);
			 const pageInput=f.querySelector("input[name=page]");
			 pageInput.value = String((parseInt(pageInput.value||"1")||1));
			 return Object.fromEntries(data.entries());
		 })()'
		 hx-swap="innerHTML">
	<!-- results will render here -->
</div>
<div id="more" class="md:block"
		 hx-get="/ui/search"
		 hx-trigger="revealed"
		 hx-target="#results"
		 hx-swap="beforeend"
		 hx-vals='js:(function(){
			 const f=document.getElementById("searchForm");
			 if(!f) return {};
			 const data=new FormData(f);
			 const page=parseInt(data.get("page")||"1");
			 data.set("page", String(page+1));
			 const obj=Object.fromEntries(data.entries());
			 // persist increment back to form for next page
			 f.querySelector("input[name=page]").value=String(page+1);
			 return obj;
		 })()'>
</div>
{{ template "footer" . }}